name: 'Parse Commit Message'
description: 'Parse pull_request.json into PR inputs'
outputs:
  title:
    value: ${{ steps.parse.outputs.title }}
  body:
    value: ${{ steps.parse.outputs.body }}
  base:
    value: ${{ steps.parse.outputs.base }}
  labels:
    value: ${{ steps.parse.outputs.labels }}
runs:
  using: 'composite'
  steps:
    - name: Parse pull_request.json
      id: parse
      run: |
        if [ -f "pull_request.json" ] && jq -e .title "pull_request.json" >/dev/null 2>&1; then
          TITLE="[AUTO] $(jq -r '.title' pull_request.json)"
          BODY=$(jq -r '.description // "No description provided."' pull_request.json)
          BASE=$(jq -r '.base // "main"' pull_request.json)
          LABELS=$(jq -r '(.labels // ["auto-generated"]) | join(",")' pull_request.json)
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "body=$BODY" >> $GITHUB_OUTPUT
          echo "base=$BASE" >> $GITHUB_OUTPUT
          echo "labels=$LABELS" >> $GITHUB_OUTPUT
        else
          echo "Error: pull_request.json missing or invalid."
          exit 1
        fi
      shell: bash